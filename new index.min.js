/**
 * Created by Administrator on 2017/2/5.
 */(function(){function g(){this.xStrat=1E3*Math.random()+300;this.yStrat=k.offsetHeight;this.xStep=500>this.xStrat?1.2+3.5*Math.random():-1.2-3.5*Math.random();this.yStep=-7-5*Math.random();this.yg=.1;this.xLeader=this.xStrat;this.yLeader=this.yStrat;this.R=Math.ceil(255*Math.random());this.G=Math.ceil(255*Math.random());this.B=Math.ceil(255*Math.random());this.boomFlag=!1;this.dotNum=20;this.dots=[];this.lineNum=10*Math.random()+20}function m(a,c){this.yg=.05;this.xLeader=a.xLeader;this.yLeader=a.yLeader;this.dotNum=10*Math.random()+20;this.dots=[];this.boomTimer=0}function h(a,c,b){var e=d.createRadialGradient(a.x,a.y,1,a.x,a.y,c/b.dots.length*5);e.addColorStop(1,"rgba("+b.R+","+b.G+","+b.B+", 0 )");e.addColorStop(0,"rgba("+b.R+","+b.G+","+b.B+","+c/b.dotNum+")");d.fillStyle=e;d.beginPath();d.arc(a.x,a.y,c/b.dots.length*5,0,2*Math.PI,!1);d.closePath();d.fill()}function l(a){void 0===a.numTemp&&(a.numTemp=a.dotNum);if(0<--a.numTemp)a.dots.push({x:a.xLeader,y:a.yLeader});else{for(var c=0;c<a.dots.length-1;c++)a.dots[c]=a.dots[c+1];a.dots[a.dots.length-1]={x:a.xLeader,y:a.yLeader}}}var k=document.getElementById("drawing"),d=k.getContext("2d"),f=[];(function(){f=[];var a=0;setInterval(function(){if(0===a++%70)for(var c=2*Math.random()+1,b=0;b<c;b++)f.push(new g);d.clearRect(0,0,1600,700);f.forEach(function(a,n){a.boomFlag?a.boom(n):a.toSky()})},15)})();g.prototype.toSky=function(){this.xLeader+=this.xStep;this.yStep+=this.yg;this.yLeader+=this.yStep;var a=this;l(this);this.dots.forEach(function(c,b){h(c,b,a)});0<this.yStep&&(this.boomFlag=!0)};g.prototype.boom=function(a){var c=this;0!==this.dots.length&&(this.dots.forEach(function(a,b){h(a,b,c)}),this.dots.shift());if(!this.lineArr){this.lineArr=[];for(var b=0;b<this.lineNum;b++)this.lineArr[b]=new m(this,b);var e=3*Math.random()+3;.5<Math.random()?this.lineArr.forEach(function(a,b){a.xStep=.5<Math.random()?6*Math.random()-3:Math.cos(2*b*Math.PI/c.dotNum)*e;a.yStep=.5<Math.random()?6*Math.random()-3:Math.sin(2*b*Math.PI/c.dotNum)*e;a.R=Math.ceil(255*Math.random());a.G=Math.ceil(255*Math.random());a.B=Math.ceil(255*Math.random())}):this.lineArr.forEach(function(a,b){a.xStep=Math.cos(2*b*Math.PI/c.dotNum)*e;a.yStep=Math.sin(2*b*Math.PI/c.dotNum)*e;a.R=c.R;a.G=c.G;a.B=c.B})}this.lineArr.forEach(function(a,b){a.xLeader+=a.xStep;a.yStep+=a.yg;a.yLeader+=a.yStep;l(a);a.dots.forEach(function(e,d){a.boomTimer+=.02;h(e,0>d-a.boomTimer?0:d-a.boomTimer,a);a.boomTimer>a.dotNum&&c.lineArr.splice(b,1)})});0===this.lineArr.length&&f.splice(a,1)}})();